var audentio=audentio||{};audentio.funbox={zones:[],funCode:{},windowWidth:0,displaySizes:[],newZone:function(e,n,t){var o=document.getElementsByTagName("script");if(o.length>0){var i=o[o.length-1].parentNode,d={id:e,rotate:n,numDisplay:t,parentEle:i,enabled:!0,lastAds:[],adOrder:[],seed:0};return d}},getZoneIndex:function(e){for(var n=0,t=audentio.funbox.zones.length;t>n;n++)if(audentio.funbox.zones[n].id===e)return n;return-1},render:function(e,n,t){var o=audentio.funbox.newZone(e,n,t);audentio.funbox.zones.push(o)},init:function(e){var n=audentio.funbox;e=JSON.parse(e),audentio.funbox.funCode=e,window.addEventListener("resize",function(){audentio.funbox.resize()}),window.addEventListener("orientationchange",function(){audentio.funbox.resize()}),n.checkSize(),n.updateAds();for(var t=0,o=n.zones.length;o>t;t++)n.zoneInit(t)},updateAds:function(){for(var e=0,n=audentio.funbox.zones.length;n>e;e++)audentio.funbox.zoneOutput(e)},resize:function(){audentio.funbox.displaySizes;audentio.funbox.checkSize(),audentio.funbox.updateAds()},checkSize:function(){audentio.funbox.windowWidth=window.innerWidth||document.documentElement.offsetWidth||document.body.offsetWidth,audentio.funbox.displaySizes=[];for(var e=audentio.funbox.funCode.devices,n=Object.keys(e),t=0,o=n.length;o>t;t++){var i=n[t];e[i].min_width<=audentio.funbox.windowWidth&&(e[i].max_width>=audentio.funbox.windowWidth||0==e[i].max_width)&&audentio.funbox.displaySizes.push(i)}},arraysEqual:function(e,n){if(e===n)return!0;if(null==e||null==n)return!1;if(e.length!=n.length)return!1;for(var t=0;t<e.length;++t)if(e[t]!==n[t])return!1;return!0},zoneOutput:function(e,n){for(var t=audentio.funbox,o=t.zones[e],i=o.numDisplay,d="",u=t.filterAdSize(t.funCode.advertisements[o.id]),a=u.length,r=[],s=[],f=0;a>f;f++)r.push(u[f].advertisement_id);if(!t.arraysEqual(r,o.lastAds)||n===!0&&i<u.length){t.arraysEqual(r,o.lastAds)||(audentio.funbox.zones[e].adOrder=[],audentio.funbox.zones[e].lastAds=r),0===i?i=a:i>a&&(i=a);for(var h=0;a>h;h++)u[h].tempWeight=o.adOrder.indexOf(h)>-1&&!t.weightBasedRotation?0:u[h].advertisement_weight||1;for(var l=0,x=i;x>l;l++){if(t.weightBasedRotation||audentio.funbox.zones[e].adOrder.length!==u.length){for(var p=[],f=0;a>f;f++)for(var b=0,z=u[f].tempWeight;z>b;b++)p.push(f);var c=Math.floor(Math.random()*p.length),v=p[c];-1===audentio.funbox.zones[e].adOrder.indexOf(v)&&(audentio.funbox.zones[e].adOrder.push(v),audentio.funbox.zones[e].seed=audentio.funbox.zones[e].adOrder.length)}else do{var v=audentio.funbox.zones[e].seed%u.length;audentio.funbox.zones[e].seed=audentio.funbox.zones[e].seed+1}while(s.indexOf(v)>-1);d+=u[v].code,t.updateImpressions(u[v],o.id),u[v].tempWeight=0,s.push(v)}o.parentEle.innerHTML=d}},updateImpressions:function(e,n){var t=e.impress_url;if(t.length>0){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){o.responseText}},o.open("GET",t,!0),o.send();for(var i=audentio.funbox.funCode.advertisements[n],d=0,u=i.length;u>d;d++)i[d].impress_url==t&&(audentio.funbox.funCode.advertisements[n][d].impress_url="")}},filterAdSize:function(e){for(var n=[],t=audentio.funbox,o=0,i=e.length;i>o;o++)if(e[o].use_custom_width&&e[o].custom_min_width<=t.windowWidth&&(e[o].custom_max_width>=t.windowWidth||0==e[o].custom_max_width))n.push(e[o]);else for(var d=e[o].devices,u=0,a=d.length;a>u;u++)for(var r=0,s=t.displaySizes.length;s>r;r++)d[u]==t.displaySizes[r]&&n.push(e[o]);return n},zoneInit:function(e){var n=audentio.funbox.zones[e],t=n.rotate,o=audentio.funbox.funCode.advertisements[n.id];t>0&&o.length>n.numDisplay&&window.setInterval(function(){audentio.funbox.zoneOutput(e,!0)},1e3*t)}};