<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="../js/d3.v4.min.js"></script>

<!-- Create a div where the graph will take place -->
<style>
.domain{
	opacity: 0;
}
.tick line{
	opacity: 0;
}
.tick text{
	font-size: 1.7em;
}

#explanation{
	font-size: 0.8em;
	font-style: italic;
	color: blue;
}

</style>
<div><h2>Fredericton Accident HeatMap (Year/Month)</h2>
	Min number of accidents (min thresh)
	<input type="text" name="acc_thresh1" id="acc_thresh" value="0"/>
	<input type="button" onclick="render()" value="Go!" />
</div>
<div id="explanation">(You can change contrast of grid colors by changing threshold value above. <br />
<strong>For example</strong>, you can have a more vivid appearance of grids that have more than <strong>50</strong> accidents by adding <strong>50</strong> in the text-box and so on.)</div>
<div id="my_dataviz"></div>

<script>
function render(){
	var thresh = document.getElementById("acc_thresh").value;
	//console.log(thresh);
	
	var element = document.getElementById('my_dataviz');
	element.remove();
	document.body.innerHTML += '<div id="my_dataviz"></div>';
	
	document.getElementById("acc_thresh").value = thresh;
	// set the dimensions and margins of the graph
	var margin = {top: 30, right: 30, bottom: 100, left: 50},
	  width = window.innerHeight - margin.left - margin.right,
	  height = window.innerHeight - margin.top - margin.bottom;

	// append the svg object to the body of the page
	var svg = d3.select("#my_dataviz")
	.append("svg")
	  .attr("width", width + margin.left + margin.right)
	  .attr("height", height + margin.top + margin.bottom)
	.append("g")
	  .attr("transform",
			"translate(" + margin.left + "," + margin.top + ")");

	// Labels of row and columns
	var year = ["2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017"]
	var month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]

	// Build X scales and axis:
	var x = d3.scaleBand()
	  .range([ 0, width ])
	  .domain(month)
	  .padding(0.05);
  
	svg.append("g")
	  .attr("transform", "translate(0, " + height + ")")
	  .call(d3.axisBottom(x))

	// Build X scales and axis:
	var y = d3.scaleBand()
	  .range([ height, 0 ])
	  .domain(year)
	  .padding(0.05);
	  
	svg.append("g")
	  .call(d3.axisLeft(y));

	// Build color scale
	var myColor = d3.scaleLinear()
	  .range(["white", "#B7280A"]) //#69b3a2
	  .domain([1,100])

	//Read the data
	d3.csv("data/monthly_distribution_by_year.csv", function(data) {
	  svg.selectAll()
		  .data(data, function(d) { return d.month+':'+d.year;})
		  .enter()
		  .append("rect")
		  .attr("x", function(d) { return x(d.month) })
		  .attr("y", function(d) { return y(d.year) })
		  .attr("width", x.bandwidth())
		  .attr("height", y.bandwidth())
		  .style("fill", function(d) { return myColor(d.total_accident - thresh)} )
		  
	  svg.selectAll()
		.data(data, function(d) { return d.month+':'+d.year;})
		.enter()
		.append('text')
		.attr("x", function(d) { return x(d.month) + x.bandwidth()/2 - x.bandwidth()/4; })
		.attr("y", function(d) { return y(d.year) + y.bandwidth()/2 + y.bandwidth()/6; })
		.text(function(d) { 
				if(d.total_accident - thresh < 0) return 0;
				return (d.total_accident - thresh); }
			)
			.attr('font-size','0.85em')
			.attr('opacity', '0.6')
	})
}

	window.onload = render();

</script>